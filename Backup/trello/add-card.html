<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aggiungi Card</title>
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css" />
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
    </style>
  </head>
  <body>
    <form id="add-card-form">
      <label for="card-name">Nome della scheda:</label>
      <input type="text" id="card-name" required />

      <label for="card-desc">Descrizione:</label>
      <textarea id="card-desc" rows="4"></textarea>

      <button type="submit" class="mod-primary">Aggiungi</button>
    </form>
    <script>
      const t = TrelloPowerUp.iframe();

      document
        .getElementById("add-card-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const name = document.getElementById("card-name").value;
          const desc = document.getElementById("card-desc").value;

          try {
            await t.card("idList").then(({ idList }) => {
              return t.set("card", "shared", { name, desc, idList });
            });
            t.closePopup();
          } catch (error) {
            console.error("Errore durante l'aggiunta della scheda:", error);
          }
        });

      t.render(() => {
        t.sizeTo("form").done();
      });
    </script>
  </body>
</html>
